<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BRMobility — Análise e Reparo em Campo</title>
<style>
:root{ --primary: #0b57a4; --bg:#f4f6f8; --card-radius:14px; --footer-height:140px; }
html,body{height:100%;margin:0;font-family:-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);}

/* vivid background logo in full color */
body::before{ content:""; position:fixed; inset:0; background-image:url('logotipo empresa.jpg'); background-size:90vw auto; background-position:center center; background-repeat:no-repeat; opacity:0.36; z-index:0; pointer-events:none; }

/* layout */
.app{position:relative; z-index:1; min-height:100vh; padding:20px; padding-bottom:20px; box-sizing:border-box; display:flex; justify-content:center;}
.wrap{width:100%; max-width:960px; display:flex; flex-direction:column; gap:18px;}
.card{background:#fff;border-radius:var(--card-radius); padding:18px; box-shadow:0 8px 28px rgba(0,0,0,0.08);}
.center{text-align:center;}
.title{font-size:24px; font-weight:800; margin:0 0 8px 0;}
.subtitle{margin:0 0 8px 0; color:#333;}
.alert{color:#b22222; font-size:13px; text-align:center; margin-top:8px;}

/* fields */
.input, textarea{width:100%; padding:12px; border-radius:10px; border:1px solid #e6e6e6; font-size:15px; box-sizing:border-box; background:#fff;}
textarea{min-height:100px; resize:vertical;}

/* buttons */
.btn{display:inline-block; padding:12px; border-radius:12px; border:none; background:var(--primary); color:#fff; font-weight:800; font-size:15px; cursor:pointer; width:100%; box-sizing:border-box;}
.btn-ghost{background:#efefef; color:var(--primary);}
.btn-small{padding:8px 12px; border-radius:10px; background:var(--primary); color:#fff; border:none; cursor:pointer;}

/* option buttons list (stacked vertical, spaced) */
.options{display:flex; flex-direction:column; gap:8px;}
.option-btn{text-align:left; padding:12px; border-radius:12px; border:none; background:var(--primary); color:#fff; font-weight:700; cursor:pointer;}
.option-btn.small{padding:10px;}
.option-btn + .solution{margin-top:6px;}
.option-btn.active{ box-shadow:0 8px 18px rgba(11,87,164,0.14); transform:translateY(-1px); }

/* solution box shown below button */
.solution{display:none; padding:12px; border-radius:10px; background:#fff; border:1px solid #eee;}
.video-btn{display:inline-block; margin-top:10px; padding:8px 12px; border-radius:8px; border:none; background:var(--primary); color:#fff; font-weight:700; cursor:pointer;}

/* preview thumbs */
.thumbs{display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;}
.thumbs img{width:96px; height:96px; object-fit:cover; border-radius:8px; border:1px solid #ddd;}

/* footer como marca d'água (atrás do conteúdo) */
footer.fixed-footer{
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  height: var(--footer-height);
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border-top: none;
  z-index: 0;
  box-sizing: border-box;
  padding: 12px;
  pointer-events: none;
  opacity: 0.15;
}
footer.fixed-footer img{
  max-height: 120px;
  width: auto;
  object-fit: contain;
}

/* responsive tweaks */
@media(max-width:520px){ 
  body::before{background-size:95vw auto; opacity:0.28} 
  .title{font-size:20px} 
  footer.fixed-footer img{max-height:98px} 
}

.small{ font-size:13px; color:#444; }

/* Espaçamento dos botões de contato */
#contacts-area{
  display: flex;
  flex-direction: column;
  gap: 20px;
}
</style>
</head>
<body>
  <div class="app">
    <div class="wrap">

      <!-- SECTION 1 -->
      <section class="card center" id="section-1">
        <h1 class="title">Análise e Reparo em Campo — Grupo BRMobility</h1>
        <p class="subtitle">Este site tem o intuito de auxiliar as manutenções em campo dos nossos Técnicos Externos, oferecendo mais velocidade em diagnóstico e reparos, assim como instruir e capacitar cada vez mais o conhecimento dos veículos do Grupo BRMobility.</p>
        <div class="alert">⚠ Esse site NÃO deve ser compartilhado com clientes ou pessoas externas ao Grupo BRMobility.</div>

        <div style="margin-top:12px; display:flex; flex-direction:column; gap:10px; align-items:stretch; max-width:680px; margin-left:auto; margin-right:auto;">
          <input id="field-chamado" class="input" type="text" placeholder="por exemplo #20991" />
          <input id="field-posto" class="input" type="text" placeholder="por exemplo Shopping BRMobility" />
          <input id="field-patrimonio" class="input" type="text" placeholder="por exemplo 0123" />
          <div class="small" style="text-align:center; color:#666;">Preencha os campos acima para prosseguir.</div>
          <button id="btn-to-model" class="btn" style="display:none;">Próximo: Escolher modelo</button>
        </div>
      </section>

      <!-- SECTION 2 - Models -->
      <section class="card" id="section-2" style="display:none;">
        <h2 style="margin:0 0 8px 0;">Qual o modelo do veículo?</h2>
        <div id="models-list" class="options"></div>
      </section>

      <!-- description -->
      <section class="card" id="section-desc" style="display:none;">
        <h3>Qual o problema descrito no chamado?</h3>
        <textarea id="field-descricao" placeholder="Descreva o problema informado pelo cliente..."></textarea>
        <div class="small" style="margin-top:8px;">Preencha para liberar as opções do modelo.</div>
      </section>

      <!-- Model-specific cards templates (will be shown/hidden by JS) -->
      <section class="card" id="card-i2" style="display:none;">
        <h3>i2-X2 — Erros</h3>
        <div id="i2-list" class="options"></div>
        <div id="i2-describe" style="display:none; margin-top:8px;">
          <textarea id="i2-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="i2-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <section class="card" id="card-i3" style="display:none;">
        <h3>i3-X3 — Problemas</h3>
        <div id="i3-list" class="options"></div>
        <div id="i3-describe" style="display:none; margin-top:8px;">
          <textarea id="i3-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="i3-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <section class="card" id="card-s6" style="display:none;">
        <h3>S6 — Problemas</h3>
        <div id="s6-list" class="options"></div>
        <div id="s6-describe" style="display:none; margin-top:8px;">
          <textarea id="s6-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="s6-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <section class="card" id="card-s8" style="display:none;">
        <h3>S8-R8-BR8 — Código de erro</h3>
        <div class="small" style="margin-bottom:8px;">Digite o número do erro (1-47) ou 0 para listar todas as opções.</div>
        <input id="s8-code" class="input" type="text" placeholder="Ex: 32 ou 0" />
        <div id="s8-list" class="options" style="margin-top:10px;"></div>
        <div id="s8-describe" style="display:none; margin-top:8px;">
          <textarea id="s8-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="s8-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <section class="card" id="card-s9" style="display:none;">
        <h3>S9-S9X — Problemas</h3>
        <div id="s9-list" class="options"></div>
        <div id="s9-describe" style="display:none; margin-top:8px;">
          <textarea id="s9-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="s9-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <section class="card" id="card-s10" style="display:none;">
        <h3>S10-S10X — Observações</h3>
        <div style="background:#fff;border:1px solid #eee;padding:12px;border-radius:10px;">
          <strong>Como funcionam os erros do S10-S10X</strong>
          <p class="small" style="margin:6px 0 0 0;">Os códigos do S10 referem-se a eventos detectados pelo painel (padrões de piscada/chave inglesa). Se não encontrar o item exato, selecione "Nenhuma" e descreva.</p>
        </div>
        <div id="s10-list" class="options" style="margin-top:10px;"></div>
        <div id="s10-describe" style="display:none; margin-top:8px;">
          <textarea id="s10-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="s10-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <section class="card" id="card-h9" style="display:none;">
        <h3>H9-H9X — Problemas</h3>
        <div id="h9-list" class="options"></div>
        <div id="h9-describe" style="display:none; margin-top:8px;">
          <textarea id="h9-custom" placeholder="Descreva o problema..." ></textarea>
        </div>
        <div id="h9-resolved" style="display:none; margin-top:10px;">
          <div style="font-weight:700;">Foi possível resolver o chamado?</div>
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="btn" onclick="markResolved('Sim')">Sim</button>
            <button class="btn btn-ghost" onclick="markResolved('Não')">Não</button>
          </div>
        </div>
      </section>

      <!-- image upload (up to 3) -->
      <section class="card" id="card-image" style="display:none;">
        <h3>Upload de imagem (opcional) — até 3 fotos</h3>
        <input id="file-input" type="file" accept="image/*" multiple />
        <div id="preview" class="thumbs" style="display:none;"></div>
        <div class="small" style="margin-top:8px;">As imagens serão enviadas junto com a mensagem no WhatsApp (se o navegador suportar). Caso contrário, anexe manualmente.</div>
      </section>

      <!-- final question -->
      <section class="card" id="card-final-extra" style="display:none;">
        <h3>Faltou algo nesse site de diagnóstico?</h3>
        <textarea id="field-final-extra" placeholder="Se sim, descreva aqui... (opcional)"></textarea>
        <div class="small" style="margin-top:8px;">Após preencher, os contatos ficarão disponíveis para envio.</div>
      </section>

      <!-- contacts -->
      <section class="card" id="card-contacts" style="display:none;">
        <h3>Enviar via WhatsApp</h3>
        <div id="contacts-area"></div>
        <div class="small" style="margin-top:16px;">Ao clicar no contato, o WhatsApp será aberto com a mensagem e imagens (quando possível).</div>
      </section>

    </div>
  </div>

  <!-- footer como marca d'água -->
  <footer class="fixed-footer" aria-hidden="true">
    <img src="logotipo empresa.jpg" alt="BRMobility Logo" />
  </footer>

<script>
const MODELS = ['i2-X2','i3-X3','S6','S8-R8-BR8','H9-H9X','S9-S9X','S10-S10X'];

const S8_ERRORS = [
  {n: 1, text: "Falha no Sensor Hall direito. Solicite a troca da placa Drive do veículo.", url: ""},
  {n: 2, text: "Falha no Sensor Hall esquerdo. Solicite a troca da placa Drive do veículo.", url: ""},
  {n: 3, text: "Falha no motor direito. Solicite a troca do veículo.", url: ""},
  {n: 4, text: "Falha no motor esquerdo. Solicite a troca do veículo.", url: ""},
  {n: 5, text: "Falha na comunicação. Solicite a troca do veículo.", url: ""},
  {n: 6, text: "Falha na bateria. Solicite a troca de bateria.", url: ""},
  {n: 7, text: "Falha no carregador. Verifique tensão do carregador.", url: ""},
  {n: 8, text: "Falha no display. Solicite troca de display.", url: ""},
  {n: 9, text: "Falha no sensor de inclinação. Solicite a troca do veículo.", url: ""},
  {n: 10, text: "Falha no sensor de velocidade. Solicite a troca do veículo.", url: ""},
  {n: 11, text: "Descrição não disponível.", url: ""},
  {n: 12, text: "Descrição não disponível.", url: ""},
  {n: 13, text: "Descrição não disponível.", url: ""},
  {n: 14, text: "Descrição não disponível.", url: ""},
  {n: 15, text: "Descrição não disponível.", url: ""},
  {n: 16, text: "Descrição não disponível.", url: ""},
  {n: 17, text: "Descrição não disponível.", url: ""},
  {n: 18, text: "Descrição não disponível.", url: ""},
  {n: 19, text: "Descrição não disponível.", url: ""},
  {n: 20, text: "Descrição não disponível.", url: ""},
  {n: 21, text: "Descrição não disponível.", url: ""},
  {n: 22, text: "Descrição não disponível.", url: ""},
  {n: 23, text: "Descrição não disponível.", url: ""},
  {n: 24, text: "Descrição não disponível.", url: ""},
  {n: 25, text: "Falha na calibração de postura. Realize a calibração de postura.", url: "https://drive.google.com/file/d/1EQ8Oi2MSb75m4Gh1mXrnKSdZUhh26AGJ/view?usp=drive_link"},
  {n: 26, text: "Descrição não disponível.", url: ""},
  {n: 27, text: "Descrição não disponível.", url: ""},
  {n: 28, text: "Descrição não disponível.", url: ""},
  {n: 29, text: "Descrição não disponível.", url: ""},
  {n: 30, text: "Descrição não disponível.", url: ""},
  {n: 31, text: "Descrição não disponível.", url: ""},
  {n: 32, text: "Descrição não disponível.", url: ""},
  {n: 33, text: "Descrição não disponível.", url: ""},
  {n: 34, text: "Descrição não disponível.", url: ""},
  {n: 35, text: "Descrição não disponível.", url: ""},
  {n: 36, text: "Descrição não disponível.", url: ""},
  {n: 37, text: "Descrição não disponível.", url: ""},
  {n: 38, text: "Descrição não disponível.", url: ""},
  {n: 39, text: "Descrição não disponível.", url: ""},
  {n: 40, text: "Descrição não disponível.", url: ""},
  {n: 41, text: "Descrição não disponível.", url: ""},
  {n: 42, text: "Descrição não disponível.", url: ""},
  {n: 43, text: "Descrição não disponível.", url: ""},
  {n: 44, text: "Descrição não disponível.", url: ""},
  {n: 45, text: "Descrição não disponível.", url: ""},
  {n: 46, text: "Descrição não disponível.", url: ""},
  {n: 47, text: "Falha na atualização do Firmware. Solicite a troca do veículo imediatamente.", url: ""}
];

const S10_ERRORS = [
  {n: 1, label: "Erro 1 - chave inglesa 1 vez", text: "Falha na Bateria (sobre tensão). Solicitar troca de bateria.", url: ""},
  {n: 2, label: "Erro 2 - chave inglesa 2 vezes", text: "Falha no Sensor de Pivô. Solicitar troca do sensor.", url: ""},
  {n: 3, label: "Erro 3 - chave inglesa 3 vezes", text: "Falha no motor. Solicitar troca do veículo.", url: ""},
  {n: 4, label: "Erro 4 - chave inglesa 4 vezes", text: "Falha na comunicação. Solicitar troca do veículo.", url: ""},
  {n: 5, label: "Erro 5 - chave inglesa 5 vezes", text: "Falha no display. Solicitar troca de display.", url: ""}
];

const I2_ERRORS = [
  {code: "C010/C018", text: "Inclinação frontal excessiva. Solicite a troca do veículo imediatamente.", url: ""},
  {code: "C020/C028", text: "Inclinação traseira excessiva. Solicite a troca do veículo imediatamente.", url: ""},
  {code: "C040/C048", text: "Limitador de velocidade frontal/traseiro ativado. Realize o procedimento pelo link.", url: "https://drive.google.com/file/d/1uHcirgVcKM_FAG7NPW4spNOP2jF6cpio/view?usp=drive_link"},
  {code: "C100/C108", text: "Bateria traseira/frontal vazia. Solicite a troca de bateria imediatamente.", url: ""},
  {code: "C200/C208", text: "Desligamento da bateria traseira/frontal. Solicite a troca de bateria imediatamente.", url: ""},
  {code: "C400/C408", text: "Ângulo de rotação excedido. Realize a solicitação de pivô mecânico para a troca.", url: ""},
  {code: "C800/C808", text: "Baixa voltagem do barramento. Solicite imediatamente a troca do veículo.", url: ""},
  {code: "Nenhuma", text: "Nenhuma das opções listadas. Descreva o problema.", url: ""}
];

const I3_ERRORS = [
  {label: "Veículo não liga", text: "Realizar o Reset do veículo e testá-lo. Verificar baterias do controle remoto e do veículo.", url: ""},
  {label: "Veículo puxando/girando", text: "Realizar calibração de postura com controle remoto original.", url: "https://drive.google.com/file/d/172xePg7Ko2ZNJNlACqlLhETxmGec20Lt/view?usp=drive_link"},
  {label: "Nenhuma", text: "Nenhuma das opções listadas. Descreva o problema.", url: ""}
];

const S6_ERRORS = [
  {label: "Veículo não liga", text: "Realizar o Reset do veículo e testá-lo.", url: ""},
  {label: "Veículo girando", text: "Realizar o procedimento de calibração de postura.", url: "https://drive.google.com/file/d/18tKva_egKDP7MeAm7ObcsHbafMtJe0Fi/view?usp=drive_link"},
  {label: "Veículo com rodas travadas", text: "Solicitar imediatamente a troca do veículo.", url: "https://drive.google.com/file/d/19kLMW1rWbcsAxmkPGM_woMHKQ0uir6oM/view?usp=drive_link"},
  {label: "Display quebrado", text: "Solicitar troca de display.", url: ""},
  {label: "Veículo desligando sozinho", text: "Solicitar troca de bateria e realizar troca.", url: "https://drive.google.com/file/d/18tKva_egKDP7MeAm7ObcsHbafMtJe0Fi/view?usp=drive_link"},
  {label: "Veículo não carrega", text: "Verificar tensão do carregador, deve estar acima de 81,5V, se estiver abaixo solicitar troca do carregador, caso esteja bom solicitar troca do veículo.", url: ""},
  {label: "Veículo andando sozinho", text: "Verificar integridade do tapete e assoalho metálico, se necessário usar um calço para dar distância entre tapete e acionadores do assoalho metálico.", url: ""},
  {label: "Veículo apitando", text: "Solicitar imediatamente a troca do veículo.", url: ""},
  {label: "Nenhuma", text: "Nenhuma das opções listadas. Descreva o problema.", url: ""}
];

const S9_ERRORS = [
  {label: "Veículo não liga", text: "Verificar tensão de bateria (>44V). Se morta, substituir.", url: ""},
  {label: "Nenhuma", text: "Nenhuma das opções listadas. Descreva o problema.", url: ""}
];

const H9_ERRORS = [
  {label: "Veículo não liga", text: "Solicitar troca do veículo imediatamente.", url: ""},
  {label: "Nenhuma", text: "Nenhuma das opções listadas. Descreva o problema.", url: ""}
];

const CONTACTS = [
  {id: "vanessa", label: "Vanessa — Analista de Relacionamento", number: "5511989477808", img: "logotipo vanessa.jpg"},
  {id: "willian", label: "Willian — Analista de Relacionamento", number: "5511956544217", img: "logotipo willian.jpg"}
];

let state = { chamado:'', posto:'', patrimonio:'', modelo:'', descricao:'', selection:'', customDescribe:'', resolved:'', finalExtra:'', files:[] };

const el = id => document.getElementById(id);
const show = node => node && (node.style.display = '');
const hide = node => node && (node.style.display = 'none');

document.addEventListener('DOMContentLoaded', ()=>{ 
  el('field-chamado').addEventListener('input', checkInitialFields);
  el('field-posto').addEventListener('input', checkInitialFields);
  el('field-patrimonio').addEventListener('input', checkInitialFields);
  el('btn-to-model').addEventListener('click', ()=> { show(el('section-2')); el('section-2').scrollIntoView({behavior:'smooth', block:'center'}); });
  renderModels();
  renderModelLists();
  el('s8-code').addEventListener('change', handleS8Input);
  el('s8-code').addEventListener('keyup', (e)=>{ if(e.key==='Enter') handleS8Input(); });
  el('file-input').addEventListener('change', handleFileChange);
  el('field-descricao').addEventListener('input', ()=>{ state.descricao = el('field-descricao').value.trim(); evaluateFinal(); });
  el('field-final-extra').addEventListener('input', ()=>{ state.finalExtra = el('field-final-extra').value.trim(); evaluateFinal(); });
  renderContacts();
  document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='visible') setTimeout(reattachListeners,200); });
  window.addEventListener('focus', ()=> setTimeout(reattachListeners,200));
  reattachListeners();
});

function checkInitialFields(){
  state.chamado = el('field-chamado').value.trim();
  state.posto = el('field-posto').value.trim();
  state.patrimonio = el('field-patrimonio').value.trim();
  if(state.chamado && state.posto && state.patrimonio){
    show(el('btn-to-model'));
  } else {
    hide(el('btn-to-model'));
  }
}

function renderModels(){
  const cont = el('models-list'); cont.innerHTML='';
  MODELS.forEach(m=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = m;
    b.onclick = ()=>{ selectModel(m); document.querySelectorAll('#models-list .option-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); };
    cont.appendChild(b);
  });
}

function selectModel(m){
  state.modelo = m;
  show(el('section-desc'));
  el('section-desc').scrollIntoView({behavior:'smooth', block:'center'});
  const onDesc = ()=>{
    state.descricao = el('field-descricao').value.trim();
    if(!state.descricao) return;
    ['card-i2','card-i3','card-s6','card-s8','card-s9','card-s10','card-h9'].forEach(id=>hide(el(id)));
    switch(state.modelo){
      case 'i2-X2': show(el('card-i2')); el('card-i2').scrollIntoView({behavior:'smooth', block:'center'}); break;
      case 'i3-X3': show(el('card-i3')); el('card-i3').scrollIntoView({behavior:'smooth', block:'center'}); break;
      case 'S6': show(el('card-s6')); el('card-s6').scrollIntoView({behavior:'smooth', block:'center'}); break;
      case 'S8-R8-BR8': show(el('card-s8')); el('card-s8').scrollIntoView({behavior:'smooth', block:'center'}); break;
      case 'H9-H9X': show(el('card-h9')); el('card-h9').scrollIntoView({behavior:'smooth', block:'center'}); break;
      case 'S9-S9X': show(el('card-s9')); el('card-s9').scrollIntoView({behavior:'smooth', block:'center'}); break;
      case 'S10-S10X': show(el('card-s10')); el('card-s10').scrollIntoView({behavior:'smooth', block:'center'}); break;
    }
    show(el('card-image')); show(el('card-final-extra')); show(el('card-contacts'));
    el('field-descricao').removeEventListener('input', onDesc);
    evaluateFinal();
  };
  el('field-descricao').addEventListener('input', onDesc);
}

function renderModelLists(){
  // i2
  const i2cont = el('i2-list'); i2cont.innerHTML='';
  I2_ERRORS.forEach(it=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = it.code;
    b.onclick = ()=>{ markActive(b); showSolutionBox(b, it.text, it.url); state.selection = it.code; if(it.code==='Nenhuma'){ show(el('i2-describe')); } else { hide(el('i2-describe')); } show(el('i2-resolved')); evaluateFinal(); };
    i2cont.appendChild(b);
    const s = document.createElement('div'); s.className='solution'; i2cont.appendChild(s);
  });

  // i3
  const i3cont = el('i3-list'); i3cont.innerHTML='';
  I3_ERRORS.forEach(it=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = it.label;
    b.onclick = ()=>{ markActive(b); showSolutionBox(b, it.text, it.url); state.selection = it.label; if(it.label==='Nenhuma'){ show(el('i3-describe')); } else { hide(el('i3-describe')); } show(el('i3-resolved')); evaluateFinal(); };
    i3cont.appendChild(b);
    const s = document.createElement('div'); s.className='solution'; i3cont.appendChild(s);
  });

  // S6
  const s6cont = el('s6-list'); s6cont.innerHTML='';
  S6_ERRORS.forEach(it=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = it.label;
    b.onclick = ()=>{ markActive(b); showSolutionBox(b, it.text, it.url); state.selection = it.label; if(it.label==='Nenhuma'){ show(el('s6-describe')); } else { hide(el('s6-describe')); } show(el('s6-resolved')); evaluateFinal(); };
    s6cont.appendChild(b);
    const s = document.createElement('div'); s.className='solution'; s6cont.appendChild(s);
  });

  // S9
  const s9cont = el('s9-list'); s9cont.innerHTML='';
  S9_ERRORS.forEach(it=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = it.label;
    b.onclick = ()=>{ markActive(b); showSolutionBox(b, it.text, it.url); state.selection = it.label; if(it.label==='Nenhuma'){ show(el('s9-describe')); } else { hide(el('s9-describe')); } show(el('s9-resolved')); evaluateFinal(); };
    s9cont.appendChild(b);
    const s = document.createElement('div'); s.className='solution'; s9cont.appendChild(s);
  });

  // H9
  const h9cont = el('h9-list'); h9cont.innerHTML='';
  H9_ERRORS.forEach(it=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = it.label;
    b.onclick = ()=>{ markActive(b); showSolutionBox(b, it.text, it.url); state.selection = it.label; if(it.label==='Nenhuma'){ show(el('h9-describe')); } else { hide(el('h9-describe')); } show(el('h9-resolved')); evaluateFinal(); };
    h9cont.appendChild(b);
    const s = document.createElement('div'); s.className='solution'; h9cont.appendChild(s);
  });

  // S10
  const s10cont = el('s10-list'); s10cont.innerHTML='';
  S10_ERRORS.forEach(it=>{
    const b = document.createElement('button'); b.className='option-btn'; b.textContent = it.label || ('Erro ' + it.n);
    b.onclick = ()=>{ markActive(b); showSolutionBox(b, it.text, it.url); state.selection = it.label || ('Erro '+it.n); show(el('s10-resolved')); evaluateFinal(); };
    s10cont.appendChild(b);
    const s = document.createElement('div'); s.className='solution'; s10cont.appendChild(s);
  });
  // add Nenhuma for S10
  const noneS10 = document.createElement('button'); noneS10.className='option-btn'; noneS10.textContent = 'Nenhuma das opções listadas';
  noneS10.onclick = ()=>{ markActive(noneS10); let nx = noneS10.nextElementSibling; while(nx && !nx.classList.contains('solution')) nx = nx.nextElementSibling; if(nx){ nx.innerHTML = '<strong>Informação:</strong> Nenhuma das opções listadas. Descreva o problema.'; nx.style.display='block'; } show(el('s10-describe')); show(el('s10-resolved')); state.selection = 'Nenhuma'; evaluateFinal(); };
  s10cont.appendChild(noneS10);
  const sn = document.createElement('div'); sn.className='solution'; s10cont.appendChild(sn);
}

function showSolutionBox(btn, text, url){
  let next = btn.nextElementSibling;
  while(next && !next.classList.contains('solution')) next = next.nextElementSibling;
  if(!next) return;
  next.innerHTML = '<strong>Informação:</strong> ' + (text || 'Informação não fornecida.');
  if(url){ 
    const v = document.createElement('button'); 
    v.className='video-btn'; 
    v.textContent='clique aqui'; 
    v.onclick = ()=> window.open(url, '_blank'); 
    next.appendChild(v); 
  }
  next.style.display = 'block'; 
  next.scrollIntoView({behavior:'smooth', block:'center'});
}

function markActive(btn){ 
  btn.parentElement.querySelectorAll('.option-btn').forEach(x=>x.classList.remove('active')); 
  btn.classList.add('active'); 
}

function handleS8Input(){
  const v = el('s8-code').value.trim();
  const list = el('s8-list'); list.innerHTML='';
  if(!v) return;
  const n = parseInt(v,10);
  if(!isNaN(n) && n>=1 && n<=47){
    const item = S8_ERRORS.find(x=>x.n===n);
    if(item){
      const b = document.createElement('button'); b.className='option-btn'; b.textContent = 'Erro ' + item.n;
      b.onclick = ()=>{ markActive(b); showSolutionBox(b, item.text, item.url); state.selection = 'Erro '+item.n; show(el('s8-resolved')); evaluateFinal(); };
      list.appendChild(b);
      const s = document.createElement('div'); s.className='solution'; list.appendChild(s);
    } else {
      const note = document.createElement('div'); note.className='small'; note.textContent = 'Erro não encontrado. Use 0 para listar todas as opções.'; list.appendChild(note);
    }
  } else if(n===0){
    S8_ERRORS.forEach(item=>{
      const b = document.createElement('button'); b.className='option-btn'; b.textContent = 'Erro ' + item.n;
      b.onclick = ()=>{ markActive(b); showSolutionBox(b, item.text, item.url); state.selection = 'Erro '+item.n; show(el('s8-resolved')); evaluateFinal(); };
      list.appendChild(b);
      const s = document.createElement('div'); s.className='solution'; list.appendChild(s);
    });
    const none = document.createElement('button'); none.className='option-btn'; none.textContent = 'Nenhuma das opções listadas';
    none.onclick = ()=>{ markActive(none); let nx = none.nextElementSibling; while(nx && !nx.classList.contains('solution')) nx = nx.nextElementSibling; if(nx){ nx.innerHTML = '<strong>Informação:</strong> Nenhuma das opções listadas. Descreva o problema.'; nx.style.display='block'; } show(el('s8-describe')); show(el('s8-resolved')); state.selection = 'Nenhuma'; evaluateFinal(); };
    list.appendChild(none);
    const sn = document.createElement('div'); sn.className='solution'; list.appendChild(sn);
  } else {
    const note = document.createElement('div'); note.className='small'; note.textContent = 'Insira um número entre 1 e 47 ou 0 para listar todas opções.'; list.appendChild(note);
  }
  evaluateFinal();
}

function markResolved(val){
  state.resolved = val;
  evaluateFinal();
}

function handleFileChange(e){
  const files = Array.from(e.target.files || []).slice(0,3);
  state.files = files;
  const preview = el('preview'); preview.innerHTML='';
  if(files.length>0){
    files.forEach(f=>{ 
      const fr = new FileReader(); 
      fr.onload = ev => { 
        const img = document.createElement('img'); 
        img.src = ev.target.result; 
        preview.appendChild(img); 
      }; 
      fr.readAsDataURL(f); 
    });
    preview.style.display='flex';
  } else {
    preview.style.display='none';
  }
  evaluateFinal();
}

function renderContacts(){
  const cont = el('contacts-area'); cont.innerHTML='';
  CONTACTS.forEach(c=>{
    const btn = document.createElement('button'); 
    btn.className='btn'; 
    btn.style.textAlign='left';
    btn.innerHTML = `<img src="${c.img}" alt="" style="height:36px; vertical-align:middle; margin-right:10px; border-radius:6px;"/> ${c.label}`;
    btn.onclick = ()=> sendWhats(c.number);
    cont.appendChild(btn);
  });
}

function buildWhatsText(){
  const parts = [];
  parts.push('*Chamado:* ' + (state.chamado || el('field-chamado').value.trim()));
  parts.push('*Posto:* ' + (state.posto || el('field-posto').value.trim()));
  parts.push('*Patrimônio:* ' + (state.patrimonio || el('field-patrimonio').value.trim()));
  parts.push('*Modelo:* ' + (state.modelo || '-'));
  parts.push('*Descrição do chamado:* ' + (state.descricao || el('field-descricao').value.trim()));
  if(state.selection) parts.push('*Seleção:* ' + state.selection);
  if(state.customDescribe) parts.push('*Descrição adicional:* ' + state.customDescribe);
  parts.push('*Chamado resolvido:* ' + (state.resolved || '-'));
  parts.push('*Imagem enviada:* ' + (state.files && state.files.length ? ('Sim ('+state.files.length+')') : 'Não'));
  if(state.finalExtra) parts.push('*Faltou algo:* ' + state.finalExtra);
  return parts.join('\n');
}

async function sendWhats(number){
  // Atualiza state com valores atuais
  state.chamado = el('field-chamado').value.trim();
  state.posto = el('field-posto').value.trim();
  state.patrimonio = el('field-patrimonio').value.trim();
  state.descricao = el('field-descricao').value.trim();
  state.customDescribe = (el('i2-custom') && el('i2-custom').value.trim()) || 
                         (el('i3-custom') && el('i3-custom').value.trim()) || 
                         (el('s6-custom') && el('s6-custom').value.trim()) || 
                         (el('s8-custom') && el('s8-custom').value.trim()) || 
                         (el('s9-custom') && el('s9-custom').value.trim()) || 
                         (el('s10-custom') && el('s10-custom').value.trim()) || 
                         (el('h9-custom') && el('h9-custom').value.trim()) || 
                         state.customDescribe || '';
  state.finalExtra = el('field-final-extra').value.trim() || state.finalExtra;

  const text = buildWhatsText();

  // Se tem arquivos, tenta enviar via Web Share API
  if(state.files && state.files.length > 0){
    try{
      // Verifica se o navegador suporta compartilhar arquivos
      if(navigator.canShare && navigator.canShare({ files: state.files })){
        await navigator.share({ 
          files: state.files, 
          text: text, 
          title: 'Chamado BRMobility' 
        });
        // Após compartilhar, abre o WhatsApp do contato selecionado
        setTimeout(()=> {
          window.open('https://wa.me/' + number + '?text=' + encodeURIComponent(text), '_blank');
        }, 800);
        return;
      } else {
        // Navegador não suporta - abre WhatsApp e avisa para anexar manualmente
        alert('Seu navegador não permite anexar arquivos automaticamente.\n\nO WhatsApp será aberto com a mensagem. Por favor, anexe as imagens manualmente.');
        window.open('https://wa.me/' + number + '?text=' + encodeURIComponent(text), '_blank');
        return;
      }
    } catch(err){
      console.warn('Erro no Web Share API:', err);
      // Se usuário cancelou ou deu erro, abre WhatsApp normalmente
      if(err.name !== 'AbortError'){
        alert('Não foi possível compartilhar as imagens automaticamente.\n\nO WhatsApp será aberto com a mensagem. Por favor, anexe as imagens manualmente.');
      }
      window.open('https://wa.me/' + number + '?text=' + encodeURIComponent(text), '_blank');
      return;
    }
  }

  // Sem arquivos - abre WhatsApp direto com a mensagem
  window.open('https://wa.me/' + number + '?text=' + encodeURIComponent(text), '_blank');
}

function evaluateFinal(){
  state.chamado = el('field-chamado').value.trim();
  state.posto = el('field-posto').value.trim();
  state.patrimonio = el('field-patrimonio').value.trim();
  state.descricao = el('field-descricao').value.trim();
  state.finalExtra = el('field-final-extra').value.trim();
}

function reattachListeners(){
  const fi = el('file-input'); 
  if(fi && !fi._ok){ 
    fi.addEventListener('change', handleFileChange); 
    fi._ok=true; 
  }
}
</script>
</body>
</html>
</html>
